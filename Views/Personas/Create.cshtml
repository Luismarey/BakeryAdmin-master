@model BakeryAdmin.Models.PersonaBase
@{
    ViewData["Title"] = "Nueva Persona";
}

<h2 class="mb-4">Nueva Persona</h2>

<form asp-action="Create" method="post" class="needs-validation" novalidate>
    @Html.AntiForgeryToken()

    <!-- Fila principal: Nombre y Apellido -->
    <div class="row g-3 mb-3">
        <div class="col-md-6">
            <div class="form-floating">
                <input asp-for="Nombres" class="form-control" maxlength="40" placeholder="Nombres" required />
                <label asp-for="Nombres">Nombre</label>
                <span asp-validation-for="Nombres" class="text-danger"></span>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <input asp-for="Apellidos" class="form-control" maxlength="40" placeholder="Apellidos" required />
                <label asp-for="Apellidos">Apellido</label>
                <span asp-validation-for="Apellidos" class="text-danger"></span>
            </div>
        </div>
    </div>

    <!-- Fila: Email y Móvil -->
    <div class="row g-3 mb-3">
        <div class="col-md-6">
            <div class="form-floating">
                <input asp-for="Correo_Electronico" class="form-control" placeholder="Email" required />
                <label asp-for="Correo_Electronico">Email</label>
                <span asp-validation-for="Correo_Electronico" class="text-danger"></span>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <input asp-for="NumCelular" class="form-control" maxlength="15" inputmode="numeric" placeholder="Móvil" required />
                <label asp-for="NumCelular">Móvil</label>
                <span asp-validation-for="NumCelular" class="text-danger"></span>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-3">
        <div class="col-md-6">
            <div class="form-floating">
                <select asp-for="TipoPersona" class="form-select" asp-items="ViewBag.TiposPersona" required>
                    <option value="">-- Selecciona Tipo Persona --</option>
                </select>
                <label asp-for="TipoPersona">Tipo Persona</label>
                <span asp-validation-for="TipoPersona" class="text-danger"></span>
            </div>
        </div>
    </div>

    <!-- Información adicional en card -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
            Información adicional
        </div>
        <div class="card-body">

            <!-- Fila: CI y Shift -->
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="NumCi" class="form-control" maxlength="15" placeholder="CI" />
                        <label asp-for="NumCi">CI</label>
                        <span asp-validation-for="NumCi" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="Fecha_Nacimiento" type="text" class="form-control" id="BirthDate" placeholder="Fecha de Nacimiento (yyyy-MM-dd)" />
                        <label asp-for="Fecha_Nacimiento">Fecha de Nacimiento (yyyy-MM-dd)</label>
                        <span asp-validation-for="Fecha_Nacimiento" class="text-danger"></span>
                    </div>
                </div>

            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="Profesion" class="form-control" maxlength="40" placeholder="Profesión" />
                        <label asp-for="Profesion">Profesión</label>
                        <span asp-validation-for="Profesion" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="Turno" class="form-control" maxlength="10" placeholder="Turno" />
                        <label asp-for="Turno">Turno</label>
                        <span asp-validation-for="Turno" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="Numero_Licencia" class="form-control" maxlength="15" placeholder="Número de Licencia" />
                        <label asp-for="Numero_Licencia">Número de Licencia</label>
                        <span asp-validation-for="Numero_Licencia" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="Categoria_Licencia" class="form-control" maxlength="2" placeholder="Categoría de Licencia" />
                        <label asp-for="Categoria_Licencia">Categoría de Licencia</label>
                        <span asp-validation-for="Categoria_Licencia" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="form-check form-switch mb-3">
                <input asp-for="Mobilidad" class="form-check-input" type="checkbox" id="Mobility" />
                <label asp-for="Mobilidad" class="form-check-label">Movilidad</label>
            </div>

            @*   <div class="form-check form-switch mb-3">
                <input asp-for="Active" class="form-check-input" type="checkbox" id="Active" />
                <label asp-for="Active" class="form-check-label">Activo</label>
            </div> *@

        </div>
    </div>

    <div class="alert alert-warning mt-3">
        <strong>Nota:</strong> Primero guarda la persona para poder agregar direcciones.
    </div>

    <!-- Botones -->
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
            <i class="fa fa-save"></i> Guardar
        </button>
        <a href="/Personas" class="btn btn-secondary">
            <i class="fa fa-times"></i> Cancelar
        </a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            // Inicializar datepicker
            $('#BirthDate').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                todayHighlight: true
            });
        });

        (() => {
            'use strict';
            const forms = document.querySelectorAll('.needs-validation');
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {

                    event.preventDefault();

                    if (!form.checkValidity()) {
                        event.stopPropagation();
                        form.classList.add('was-validated');
                        return;
                    }

                    Swal.fire({
                        title: '¿Deseas guardar este registro?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, guardar',
                        cancelButtonText: 'Cancelar',
                        reverseButtons: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            form.submit();
                        }
                    });
                }, false);
            });
        })();

            function cargarDirecciones() {
            let personaId = $("#PersonaId").val();
            $.get("/Direcciones/Listar", { personaId }, function (data) {
                let rows = "";
                data.forEach(d => {
                    rows += `<tr>
                                <td>${d.zona ?? ""}</td>
                                <td>${d.calle ?? ""}</td>
                                <td>${d.numero ?? ""}</td>
                                <td><button class="btn btn-danger btn-sm" onclick="eliminarDireccion(${d.direccionId})">Eliminar</button></td>
                            </tr>`;
                });
                $("#tablaDirecciones tbody").html(rows);
            });
        }

    </script>
}
